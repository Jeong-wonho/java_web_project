<head>
  <link href="../css/slur_apply_teacher.css" rel="stylesheet" />
</head>
<h2>학생신청</h2>
<div class="s_apply_info_apply">
  <form
    class="col-md-12 was-validated"
    method="post"
    enctype="multipart/form-data"
  >
    <div class="student_profile mb-3">
      <div class="profile_rect">
        <img
          class="profile_img"
          src="http://placehold.it/150X150"
          name="profile_img"
          id="student_profile_img"
          style="width: 150px; height: 150px"
        />
        <div class="profile_rect_file">
          <label for="fileup">사진업로드</label>
          <input type="file" name="photoFile" id="fileup" />
        </div>
      </div>
      <div class="custom-file mb-3 student_apply_need_docs">
        <div class="doc_filebox">
          <input class="upload-name" value="파일선택" disabled="disabled" />
          <label for="doc_filename">파일업로드</label>
          <input
            type="file"
            id="doc_filename"
            class="upload-hidden"
            name="docFile"
          />
        </div>
        <div class="student_inst">
          <label for="student_inst_label">배우고싶은 악기입력</label>
          <input
            type="text"
            class="form-control is-invalid"
            name="student_inst"
            id="student_inst_input"
            placeholder="원하는 악기 입력"
            required
          />
        </div>
        <div class="col-md-12 mb-3 student_selection">
          <select
            class="custom-select d-block w-100 mt-3 is-invalid student_degree"
            id="student_degree"
            name="student_edu"
            required=""
          >
            <option value="">학력선택</option>
            <option value="중1">중1</option>
            <option value="중2">중2</option>
            <option value="중3">중3</option>
            <option value="고1">고1</option>
            <option value="고2">고2</option>
            <option value="고3">고3</option>
          </select>

          <select
            class="custom-select d-block w-100 mt-3 is-invalid student_program"
            id="stduent_program"
            required=""
            name="student_program"
          >
            <option value="">프로그램 선택</option>
            <option value="2104">크레센도</option>
          </select>
        </div>
      </div>
    </div>

    <div class="mb-3 student_introduce">
      <label for="validationTextarea">자기소개</label>
      <textarea
        class="form-control is-invalid student_introduceForm"
        id="introduceTextarea"
        placeholder="자기소개 입력해주세요"
        required
        name="student_introduce"
      ></textarea>
      <div class="invalid-feedback"></div>
    </div>
    <button
      class="btn btn-lg btn-primary btn-block student_apply_button"
      type="submit"
      style="float: right"
    >
      등록
    </button>
  </form>
</div>
<script>
  //파일 올릴때 thumb-nail바꾸기
  function handleImgFileSelect(e) {
    var files = e.target.files;
    var filesArr = Array.prototype.slice.call(files);

    filesArr.forEach(function (f) {
      if (!f.type.match("image.*")) {
        alert("확장자는 이미지 확장자만 가능합니다.");
        return;
      }
      sel_file = f;

      var reader = new FileReader();
      reader.onload = function (e) {
        $("#student_profile_img").attr("src", e.target.result);
      };
      reader.readAsDataURL(f);
    });
  }
  //데이터 불러오기 get
  $("button.student_apply_button").click(function () {
    var formData = new FormData($("div.s_apply_info_apply>form")[0]);

    formData.forEach(function (value, key) {
      console.log(key + ":" + value);
    });

    $.ajax({
      url: "/slur/uploadstudent",
      method: "POST",
      processData: false,
      contentType: false,
      data: formData,
      success: function (responseObj) {
        console.log(responseObj);
        responseObj.photoFileName;
        $("img.profile_img").attr(
          "src",
          "/slur/upload/" + responseObj.photoFileName
        );
        alert("등록 성공 되었습니다.");
        $(location).href("slur_main.html");
      },
      error: function (jqXHR) {
        alert("에러:" + jqXHR.status);
      },
    });
    return false;
  });

  $(document).ready(function () {
    $("#fileup").on("change", handleImgFileSelect);
    var fileTarget = $(".doc_filebox .upload-hidden");

    fileTarget.on("change", function () {
      // 값이 변경되면
      if (window.FileReader) {
        // modern browser
        var filename = $(this)[0].files[0].name;
      } else {
        // old IE
        var filename = $(this).val().split("/").pop().split("\\").pop(); // 파일명만 추출
      }

      // 추출한 파일명 삽입
      $(this).siblings(".upload-name").val(filename);
    });
  });
</script>
